# Проект по Структури от данни - База данни с числа и символни низове

Описание на приложението:
=
Приложението База данни поддържа работа с множество таблици. С него могат да се създават и изтриват таблици, да се съхраняват и изтриват данни от таблица, да се извлича информация по даден критерий и сортирано извеждане. Предназначена е за малки по обем таблици и заеманата памет на диска е възможно най-малка, тъй като данните от тип string се запазват в реалния им размер, а не се заделя предварително фиксиран размер на колоната от този тип.

СУБД съхранява всяко име на съществуваща таблица във файл с име ListTables и разширение .txt за по-лесно намиране и поддръжка на таблиците.

Всяка таблица се съхранява в отделен бинарен файл, с разширение .tbl . В началото на всеки файл (хедър) се съхранява информация за имената и типа на колоните под формата на string, като първо във файла се записва дължината на низа като unsigned int с 4 байта памет, след него самия низ. След хедъра се записват съдържанието самите редовете. В началото на всеки ред програмата добавя индекс (поредния номер на реда + 1). Низът с информация за имената и типа на колоните е с индекс 0. Този индекс не се извежда на екрана, но се използва при реализацията на функциите. Таблицата може да има произволен брой колони, като всяка колона е от тип int или string. Всеки ред е с неограничена дължина. За типа int се заделят 4 байта памет, а за типа string във файла се записва първо дължината на низа като unsigned int с 4 байта памет, след него самия низ.

Със създаването на всяка таблица се създава бинарен файл, с разширение .info, в който се запазва дължината на всеки един ред (включително и дължината на хедъра) като дължината е от тип int с 4 байта памет. Този файл има за цел да подпомогне реализацията на функциите, като позволява директно позициониране на конкретен ред във файла с таблицата.

Изтриването на ред/редове чрез команда Remove не изтрива физически редовете от файла, а ги маркира като изтрити. Това става като във файла с разширение .info съдържанието на записа се умножава по (-1), за да се запази дължината на реда, която отговаря на дължината на реда във файла с таблицата. За физическо изтриване на ред/редове е създадена функция Compact.

Всяка функция се въвежда на черния екран и след натискане на Enter се подава на програмата и започва изпълнение на функцията.

При въвеждане на грешна команда или невалидно изискване програмата ще съобщи за вашата грешка. В показания по надолу формат на всяка функция неспазването на интервалите ще доведе до грешка в програмата. За изход от програмата се използва командата Quit. Това гарантира запазване целостта на информацията във файловете.

Въвеждането в програмата на ред се осъществява чрез масив от абстрактния клас ColumnType, наследен от IntType и StringType, съответно за типовете int и string. Масивът съхранява временно само по един ред от таблицата.

За по-лесно достъпване до информацията за типа и имената на колоните е създадена структура Column с име и тип (enum type) за всяка колона. Създаден е клас ColumnInfo, който съхранява масив от колоните съдържащи информацията.

Функции поддържани от СУБД:
=

**CreateTable**

Създава нова таблица по подадено име и списък от имената и типовете на съставящите я колони. Подава се в следния формат:

CreateTable име_на_таблица (име_на_колона:тип, име_на_колона:тип и т.н.)

Функцията добавя името на таблицата във файла с имена на таблици. След това създава файл с разширение .tbl, в който ще бъдат съхраняване редовете, и поставя входния низ (име_на_колона:тип, име_на_колона:тип и т.н.) в началото на файла. Създава файл с разширение .info и записва дължината на водния низ.

**DropTable**

Премахва таблица по нейното име. Подава се в следния формат:

DropTable име_на_таблица

Функцията гарантира премахване на таблицата от файла с имена на таблици и премахване от диска на файлове с разширение .tbl и .info.

**ListTable**

Извежда списък от имената на всички налични таблици. Подава се в следния формат:

**ListTables**

Функцията извежда съдържанието на файла с имена на таблици, като преди това извежда колко са наличните таблици в СУБД.

**TableInfo**

Извежда информация (схема и брой записи) за таблица по подадено име. Подава се в следния формат:

TableInfo име_на_таблица

Функцията извежда информацията за имената и типа на колоните като взима хедъра на файла с разширение .tbl. Броят на редовете и паметта заемана на диска се изчислява от информацията за всеки ред във файла с разширение .info. Паметта заемана на диска може да не е реалната памет ако е извикана функция Remove без

Compact. Изчислението на паметта включва само редовете с положителна стойност във файла с разширение .info.

**Select**

Изпълнява заявка за извличане на данни от конкретна таблица. Функцията поддържа няколко формата в зависимост заявката:

- Заявка за извличане на данни без сортиране

Select име_колона FROM име_на_таблица WHERE израз

Select * FROM име_на_таблица WHERE израз

- Заявка за извличане на данни със сортиране

Select име_колона FROM име_на_таблица WHERE израз ORDER BY име_колона

Select * FROM име_на_таблица WHERE израз ORDER BY име_колона

Функцията взема името на колоната и името на таблицата. С името на таблицата създава обект от клас Table. Този клас извиква функция, която извлича низа с информация от хедъра на файла с разширение .tbl. Създава се обект на класа, със информацията за имената и типа на колоните. Извиква се вътрешна функция за класа. Проверява се дали заявката за извличане е със сортиране, извиква се отделна функция, в зависимост от това дали трябва сортиране. В извиканата функция се създава опашка, която съхранява имената, операторите за сравнение, стойностите, по които ще се сравнява и логическите операции. В Select може да има и по-сложни изрази с логически операции, като при използване на повече от една логическа операция трябва да бъдат оградени с кръгли скоби (). Ако е извикана функцията за извеждане със сортиране останалият низ съхранява колоната по която ще се сортира. Файла с разширение .info се зарежда в паметта като масив от дължините на всеки ред. Ако съдържанието на конкретен запис има отрицателна стойност в масива, този запис се прескача във файла. Всеки ред се въвежда като първо се види от какъв тип е колоната и след това се добавя в абстрактния масив. За всеки ред въведен в програмата се извиква функция, която проверява дали отговаря на съответната заявка за извличане. Ако заявката е без сортиране реда директно се извежда и продължава със следващия ред от файла. Ако заявката е със сортиране в нов масив се

съхранява индекса на реда, в друг масив данната, от съответната колона, която ще бъде сортирана. При сортирането всяка промяна на данната се отразява и в масива с индекси. Когато се изпълни функцията със сортировка от масива с индекси подредени по зададения критерий се извеждат редовете от файла.

**Remove**

Премахва определени редове от таблица. Подава се в следния формат:

Remove FROM име_на_таблица WHERE израз

Функцията взема името на таблицата и създава обект от клас Table. Този клас извиква функция, която извлича низа с информация от хедъра на файла с разширение .tbl. Създава се обект на класа, със информацията за имената и типа на колоните. Извиква се вътрешна функция за класа. В извиканата функция се създава опашка, която съхранява имената, операторите за сравнение, стойностите, по които ще се сравнява и логическите операции. И в Remove може да има и по-сложни изрази с логически операции, като при използване на повече от една логическа операция трябва да бъдат оградени с кръгли скоби ().Ако даден ред има отрицателна стойност в масива се прескача във файла. Всеки ред се въвежда като първо се види от какъв тип е колоната и след това се добавя в абстрактния масив. За всеки ред въведен в програмата се извиква функция, която проверява дали отговаря на изискване за премахване. Ако отговаря то дължината на реда във файла с разширение .info се умножава по (-1) и по този начин се маркира, че този ред е обозначен за изтриване.

**Insert**

Добавя един или повече нови редове в таблица. Подава се в следния формат:

Insert INTO име_на_таблица {(стойност, стойност, и т.н.), (…), и т.н.}

Функцията взема името на таблицата и създава обект от клас Table. Този клас извиква функция, която извлича низа с информация от хедъра на файла с разширение .tbl. Създава се обект на класа, със информацията за имената и типа на колоните. Извиква се вътрешна функция за класа. В извиканата функция се обхожда входния низ от

{ до }. От файла с разширение .info се взима дължината, която е следващия индекс, който трябва да се запише във файла с разширение .tbl. До срещане на ) е запис на нов ред във файла с разширение .tbl. При достигане на ) се записва дължината на новодобавения ред във файла с разширение .tbl.

**Compact**

Премахва редовете на таблица, по нейното име, които са били маркирани като изтрити. Подава се в следния формат:

Compact име_на_таблица

Функцията гарантира премахване на редовете от файла с разширение .tbl и премахване на отрицателните записи във файла с разширение .info. Функцията взема името на таблицата и създава обект от клас Table. Този клас извиква функция, която извлича низа с информация от хедъра на файла с разширение .tbl. Създава се обект на класа, със информацията за имената и типа на колоните. Извиква се функция за класа. В извиканата функция в нов временен файл се записват само записите, които имат положителна дължина в масива с дължини. Изтрива се досегашният файл и временния се преименува с името на изтрития. Променя се по същия начин и файла с дължините на всеки ред.
